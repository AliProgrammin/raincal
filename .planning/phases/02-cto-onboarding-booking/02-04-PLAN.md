# Plan 02-04: Test Complete Booking Workflow

**Phase:** 2 - CTO Onboarding and Core Booking
**Objective:** Verify end-to-end booking workflow works correctly
**Requirements:** All Phase 2 requirements

## Context

All features should be configured. This plan tests the complete workflow:
1. CTO setup (calendar, availability, event types)
2. Student booking (guest booking, auto-confirm)
3. Notifications (email confirmation, reminders)

## Prerequisites

- Google Calendar integration configured (Plan 02-01)
- Email service configured (Plan 02-02)
- Organization/admin configured (Plan 02-03)

## Tasks

### Task 1: CTO Setup Flow

As a test CTO:

1. **Accept organization invite** (if using Organizations)
2. **Connect Google Calendar**:
   - Settings → Calendars → Connect Google Calendar
   - Verify calendar appears
3. **Set availability**:
   - Settings → Availability
   - Set working hours (e.g., Mon-Fri 9am-5pm)
   - Set buffer time between meetings (e.g., 15 min)
4. **Create event type**:
   - Event Types → Create
   - Name: "30-Minute Advisory Session"
   - Duration: 30 minutes
   - Location: Cal Video (built-in)
   - Confirm auto-confirmation is enabled
5. **Add profile info**:
   - Settings → Profile
   - Add bio: "CTO at Example Corp, 10+ years in tech"
   - Upload profile photo

### Task 2: Student Booking Flow

As a student (guest):

1. **Find CTO booking page**:
   - Visit: http://localhost:3000/[cto-username]
   - Or: http://localhost:3000/[cto-username]/30-minute-advisory-session
2. **Select time slot**:
   - View available times (should respect CTO availability)
   - Select a slot
3. **Book as guest**:
   - Enter name and email
   - Add optional notes
   - Confirm booking
4. **Verify confirmation**:
   - See confirmation page
   - Check guest email for confirmation
   - Check CTO email for notification

### Task 3: Verify Features

**CTO-01: Google Calendar**
- [ ] CTO can connect Google Calendar
- [ ] Existing events block availability

**CTO-03: Availability**
- [ ] CTO can set working hours
- [ ] Only working hours show as available

**CTO-04: Buffer Time**
- [ ] Buffer time between meetings enforced

**CTO-06: Event Types**
- [ ] CTO can create event types
- [ ] Event types have duration, location options

**BOOK-04: Guest Booking**
- [ ] Students can book without account
- [ ] Only name/email required

**BOOK-05: Auto-Confirm**
- [ ] Bookings auto-confirm
- [ ] No approval step for CTO

**BOOK-06: Confirmation Email**
- [ ] Guest receives confirmation email
- [ ] CTO receives notification email

**VIDEO-01: Cal Video**
- [ ] Cal Video link generated for booking
- [ ] Both parties can join video call

### Task 4: Test Edge Cases

1. **Double booking prevention**:
   - Book a slot
   - Try to book same slot again
   - Should be unavailable

2. **Calendar conflict**:
   - Add event in Google Calendar
   - Verify slot blocked in RainCal

3. **Timezone handling**:
   - Verify times display correctly
   - Test with user in different timezone

### Task 5: Document Known Issues

Record any issues or gaps for later phases or manual workarounds.

## Verification

All Phase 2 success criteria met:

- [ ] Admin can add CTOs to organization
- [ ] CTO can connect Google Calendar
- [ ] CTO can set availability schedule
- [ ] CTO can create event types
- [ ] Student can book as guest (email only)
- [ ] Booking auto-confirms
- [ ] Email confirmations sent
- [ ] Admin can view bookings dashboard

## Notes

- Outlook Calendar (CTO-02) can be added similar to Google
- Email reminders (BOOK-07) depend on cron jobs being configured
- In-person meetings (VIDEO-03) just need location type set
