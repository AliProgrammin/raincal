---
phase: 01-fork-brand-deploy
plan: 04
type: execute
wave: 3
depends_on: ["01-03"]
files_modified:
  - raincal-fork/.env.production
  - raincal-fork/vercel.json (if Vercel)
autonomous: true

must_haves:
  truths:
    - "RainCal is accessible at production URL"
    - "Admin can log in to production instance"
    - "Booking flow works end-to-end"
  artifacts:
    - path: "raincal-fork/.env.production"
      provides: "Production environment configuration"
  key_links:
    - from: "raincal application"
      to: "production database"
      via: "DATABASE_URL"
---

<objective>
Deploy RainCal to production with database and make accessible at a URL.

Purpose: Make RainCal available for actual use by students and CTOs. Validates that the fork, branding, and configuration work in a production environment.

Output: Live RainCal instance accessible at public URL with working booking flow.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-fork-brand-deploy/01-RESEARCH.md

# Deployment options
Research identifies: Vercel (Pro required), Railway, Render as viable options.
Railway recommended for simpler PostgreSQL setup.
Build-time database requirement is critical (PITFALL from research).
</context>

<tasks>

<task type="auto">
  <name>Set up Railway project with PostgreSQL</name>
  <files>N/A (Railway dashboard)</files>
  <action>
    Create Railway project for RainCal deployment:

    1. Go to railway.app and create new project
    2. Add PostgreSQL plugin to project
    3. Copy DATABASE_URL from PostgreSQL service settings
    4. Create new service from GitHub repository (the fork)

    Alternative (if Railway not available):
    - Use Render with PostgreSQL add-on
    - Or Vercel with external PostgreSQL (Neon/Supabase)

    Why Railway: Includes PostgreSQL, simple GitHub deployment, free tier available.
  </action>
  <verify>
    1. Railway project exists
    2. PostgreSQL service running
    3. DATABASE_URL available
  </verify>
  <done>Railway project created with PostgreSQL database</done>
</task>

<task type="auto">
  <name>Configure production environment variables</name>
  <files>Railway environment variables panel</files>
  <action>
    Set environment variables in Railway dashboard:

    ```bash
    # Database (from Railway PostgreSQL)
    DATABASE_URL=[copied from PostgreSQL service]

    # Authentication (generate new secrets for production)
    NEXTAUTH_SECRET=[openssl rand -base64 32]
    CALENDSO_ENCRYPTION_KEY=[openssl rand -base64 24]

    # URLs (use Railway-provided domain initially)
    NEXTAUTH_URL=https://raincal-production.up.railway.app
    NEXT_PUBLIC_WEBAPP_URL=https://raincal-production.up.railway.app
    NEXT_PUBLIC_WEBSITE_URL=https://raincal-production.up.railway.app
    ALLOWED_HOSTNAMES='"raincal-production.up.railway.app"'

    # Branding
    NEXT_PUBLIC_APP_NAME=RainCal
    NEXT_PUBLIC_COMPANY_NAME=RainCode University Accelerator
    NEXT_PUBLIC_SUPPORT_MAIL_ADDRESS=support@raincode.tech

    # Signup
    NEXT_PUBLIC_DISABLE_SIGNUP=false
    NEXT_PUBLIC_LICENSE_CONSENT=true
    ```

    Generate secrets locally:
    ```bash
    openssl rand -base64 32  # NEXTAUTH_SECRET
    openssl rand -base64 24  # CALENDSO_ENCRYPTION_KEY
    ```
  </action>
  <verify>
    All environment variables set in Railway dashboard
  </verify>
  <done>Production environment variables configured</done>
</task>

<task type="auto">
  <name>Deploy and run database migrations</name>
  <files>N/A (Railway handles deployment)</files>
  <action>
    1. Trigger deployment from Railway dashboard or push to connected branch

    2. Railway will run build command (yarn build) automatically

    3. After deployment, run migrations via Railway shell or one-off command:
       ```bash
       yarn workspace @calcom/prisma db-deploy
       ```

    4. Seed initial data if needed

    Build command: yarn build
    Start command: yarn start
  </action>
  <verify>
    1. Deployment succeeds (check Railway logs)
    2. Database migrations complete
    3. Application starts
  </verify>
  <done>Application deployed with database migrations applied</done>
</task>

<task type="auto">
  <name>Verify production deployment</name>
  <files>N/A (browser verification)</files>
  <action>
    Comprehensive verification checklist:

    1. Access production URL
    2. Homepage loads with RainCode branding
    3. Create admin account via signup
    4. Log in successfully
    5. Navigate dashboard
    6. Create test event type
    7. View booking page
    8. Complete test booking as guest
    9. Verify confirmation displays

    Document any issues for resolution.
  </action>
  <verify>
    - [ ] Homepage loads
    - [ ] RainCode branding visible
    - [ ] Can create account
    - [ ] Can log in
    - [ ] Can create event type
    - [ ] Can view booking page
    - [ ] Guest booking works
  </verify>
  <done>Production deployment verified with working booking flow</done>
</task>

<task type="auto">
  <name>Document deployment configuration</name>
  <files>.planning/phases/01-fork-brand-deploy/DEPLOYMENT.md</files>
  <action>
    Create deployment documentation:

    ```markdown
    # RainCal Deployment Configuration

    ## Platform
    Railway (or chosen platform)

    ## Production URL
    https://[railway-domain].up.railway.app

    ## Services
    - Web application (Next.js)
    - PostgreSQL database

    ## Environment Variables
    See Railway dashboard for full list.
    Secrets stored securely in Railway.

    ## Deployment Process
    1. Push to main branch triggers deployment
    2. Railway runs yarn build
    3. Migrations applied automatically or manually
    4. Application restarts with new code

    ## Custom Domain (future)
    When ready:
    1. Add custom domain in Railway
    2. Update DNS CNAME record
    3. Update NEXTAUTH_URL, NEXT_PUBLIC_WEBAPP_URL
    4. Redeploy
    ```
  </action>
  <verify>
    Documentation file created
  </verify>
  <done>Deployment configuration documented</done>
</task>

</tasks>

<verification>
1. RainCal accessible at production URL
2. Admin can create account and log in
3. Booking flow works (create event type, view booking page, book as guest)
4. RainCode branding displays correctly
5. No errors in deployment logs
</verification>

<success_criteria>
- Live RainCal instance accessible at public URL
- Database connected and migrations applied
- Admin account created
- Test booking flow completes successfully
- Deployment process documented for future updates
</success_criteria>

<output>
After completion, create `.planning/phases/01-fork-brand-deploy/01-04-SUMMARY.md`
</output>
